global:
  storageClass: gp3
  clusterName: "prod-eks-us-west-2"
  cloud: "aws"
telemetryStoreMigrator:
  enableReplication: true
  timeout: "20m"
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
clickhouse:
  enabled: true
  zookeeper:
    enabled: true
    replicaCount: 3
    readinessProbe:
      enabled: true
      initialDelaySeconds: 15
      periodSeconds: 5
    livenessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: "1"
        memory: 2Gi
    nodeSelector:
      node.kubernetes.io/role: observability
    tolerations:
      - key: "dedicated"
        operator: "Equal"
        value: "observability"
        effect: "NoSchedule"
  persistence:
    enabled: true
    storageClass: gp3
    size: 100Gi
    accessModes:
      - ReadWriteOnce
  resources:
    requests:
      cpu: "2"
      memory: 8Gi
    limits:
      cpu: "4"
      memory: 16Gi
  layout:
    shardsCount: 2
    replicasCount: 2
  nodeSelector:
    node.kubernetes.io/role: observability
  tolerations:
    - key: "dedicated"
      operator: "Equal"
      value: "observability"
      effect: "NoSchedule"
  settings:
    prometheus/endpoint: /metrics
    prometheus/port: 9363
  podAnnotations:
    signoz.io/scrape: "true"
    signoz.io/port: "9363"
    signoz.io/path: "/metrics"
  coldStorage:
    enabled: true
    type: s3
    endpoint: "https://s3.us-west-2.amazonaws.com"
    accessKey: "${AWS_ACCESS_KEY_ID}"
    secretAccess: "${AWS_SECRET_ACCESS_KEY}"
    bucket: "signoz-cold-storage-prod"
otelCollector:
  enabled: true
  replicaCount: 3
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
  resources:
    requests:
      cpu: "500m"
      memory: 1Gi
    limits:
      cpu: "2"
      memory: 4Gi
  nodeSelector:
    node.kubernetes.io/role: observability
  tolerations:
    - key: "dedicated"
      operator: "Equal"
      value: "observability"
      effect: "NoSchedule"
  config:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: "0.0.0.0:4317"
            max_recv_msg_size_mib: 32
          http:
            endpoint: "0.0.0.0:4318"
      prometheus:
        config:
          scrape_configs:
            - job_name: 'ray-serve'
              kubernetes_sd_configs:
                - role: pod
              relabel_configs:
                - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_component]
                  action: keep
                  regex: ray-serve-app
                - source_labels: [__meta_kubernetes_pod_ip]
                  target_label: __address__
                  replacement: '$1:8001'
                - source_labels: [__meta_kubernetes_namespace]
                  target_label: k8s_namespace
                - source_labels: [__meta_kubernetes_pod_name]
                  target_label: k8s_pod_name
                - target_label: cluster
                  replacement: prod-eks-us-west-2
            - job_name: 'ray-cluster'
              kubernetes_sd_configs:
                - role: pod
                  namespaces:
                    names:
                      - ray-system
              relabel_configs:
                - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
                  action: keep
                  regex: ray
                - source_labels: [__meta_kubernetes_pod_ip]
                  target_label: __address__
                  replacement: '$1:8080'
                - target_label: cluster
                  replacement: prod-eks-us-west-2
            - job_name: 'postgres'
              static_configs:
                - targets: ['app-postgres-r.databases.svc.cluster.local:9187']
              relabel_configs:
                - target_label: cluster
                  replacement: prod-eks-us-west-2
    processors:
      batch:
        send_batch_size: 10000
        timeout: 5s
      memory_limiter:
        limit_mib: 3000
        spike_limit_mib: 500
        check_interval: 5s
      k8sattributes:
        extract:
          metadata:
            - k8s.pod.name
            - k8s.pod.uid
            - k8s.deployment.name
            - k8s.namespace.name
            - k8s.node.name
            - k8s.cluster.name
    exporters:
      clickhousetraces:
        datasource: "tcp://signoz:27ff0399-0d3a-4bd8-919d-17c2181e6fb9@clickhouse.signoz.svc.cluster.local:9000/signoz_traces"
        timeout: 30s
        retry_on_failure:
          enabled: true
          initial_interval: 5s
          max_interval: 30s
          max_elapsed_time: 300s
      signozclickhousemetrics:
        dsn: "tcp://signoz:27ff0399-0d3a-4bd8-919d-17c2181e6fb9@clickhouse.signoz.svc.cluster.local:9000/signoz_metrics"
        timeout: 30s
      clickhouselogsexporter:
        dsn: "tcp://signoz:27ff0399-0d3a-4bd8-919d-17c2181e6fb9@clickhouse.signoz.svc.cluster.local:9000/signoz_logs"
        timeout: 15s
    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [memory_limiter, k8sattributes, batch]
          exporters: [clickhousetraces]
        metrics:
          receivers: [otlp, prometheus]
          processors: [memory_limiter, k8sattributes, batch]
          exporters: [signozclickhousemetrics]
        logs:
          receivers: [otlp]
          processors: [memory_limiter, k8sattributes, batch]
          exporters: [clickhouselogsexporter]
  podAnnotations:
    signoz.io/scrape: "true"
    signoz.io/port: "8888"
frontend:
  replicaCount: 2
  resources:
    requests:
      cpu: "250m"
      memory: 256Mi
    limits:
      cpu: "500m"
      memory: 512Mi
  service:
    type: ClusterIP
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
queryService:
  replicaCount: 3
  resources:
    requests:
      cpu: "500m"
      memory: 1Gi
    limits:
      cpu: "2"
      memory: 4Gi
  nodeSelector:
    node.kubernetes.io/role: observability
  tolerations:
    - key: "dedicated"
      operator: "Equal"
      value: "observability"
      effect: "NoSchedule"
  podAnnotations:
    signoz.io/scrape: "true"
    signoz.io/port: "8080"
alertmanager:
  enabled: true
  config:
    route:
      receiver: 'slack-notifications'
    receivers:
      - name: 'slack-notifications'
        slack_configs:
          - api_url: "${SLACK_WEBHOOK_URL}"
            channel: '#alerts'
            send_resolved: true